const CF_WORKER_URL="https://ippure-proxy.snove999.workers.dev/api/ippure",IP_CHECK_URL="http://ip-api.com/json/?fields=query",TIMEOUT=15e3,FLAG_MAP={US:"ğŸ‡ºğŸ‡¸",CN:"ğŸ‡¨ğŸ‡³",HK:"ğŸ‡­ğŸ‡°",TW:"ğŸ‡¹ğŸ‡¼",JP:"ğŸ‡¯ğŸ‡µ",KR:"ğŸ‡°ğŸ‡·",SG:"ğŸ‡¸ğŸ‡¬",GB:"ğŸ‡¬ğŸ‡§",DE:"ğŸ‡©ğŸ‡ª",FR:"ğŸ‡«ğŸ‡·",NL:"ğŸ‡³ğŸ‡±",AU:"ğŸ‡¦ğŸ‡º",CA:"ğŸ‡¨ğŸ‡¦",RU:"ğŸ‡·ğŸ‡º",IN:"ğŸ‡®ğŸ‡³",BR:"ğŸ‡§ğŸ‡·",IT:"ğŸ‡®ğŸ‡¹",ES:"ğŸ‡ªğŸ‡¸",TR:"ğŸ‡¹ğŸ‡·",TH:"ğŸ‡¹ğŸ‡­",VN:"ğŸ‡»ğŸ‡³",PH:"ğŸ‡µğŸ‡­",MY:"ğŸ‡²ğŸ‡¾",ID:"ğŸ‡®ğŸ‡©",AE:"ğŸ‡¦ğŸ‡ª"};function getFlag(e){return FLAG_MAP[e?.toUpperCase()]||"ğŸ³ï¸"}function getEmoji(e){return null==e||isNaN(e)?"â“":e<=10?"âšª":e<=30?"ğŸŸ¢":e<=50?"ğŸŸ¡":e<=70?"ğŸŸ ":e<=90?"ğŸ”´":"âš«"}function getScoreText(e){return null==e||isNaN(e)?"æœªçŸ¥":e<=10?"æä½³":e<=30?"è‰¯å¥½":e<=50?"ä¸€èˆ¬":e<=70?"è¾ƒå·®":e<=90?"å¾ˆå·®":"æå·®"}function getBgColor(e){return null==e?"#909399":e<=10?"#4A90D9":e<=30?"#67C23A":e<=50?"#E6A23C":e<=70?"#F56C6C":"#909399"}function getSelectedNode(){try{if("undefined"!=typeof $environment&&$environment.params?.node)return $environment.params.node}catch(e){}return null}function httpGet(e){return new Promise((t,r)=>{$httpClient.get(e,(e,n,o)=>{e?r(new Error(e)):t({response:n,data:o})})})}async function getExitIP(e){const t={url:IP_CHECK_URL,timeout:TIMEOUT,headers:{"User-Agent":"curl/7.64.1"}};e&&(t.node=e);const{data:r}=await httpGet(t),n=JSON.parse(r);if(!n.query)throw new Error("æ— æ³•è·å–å‡ºå£ IP");return n.query}async function queryIPPure(e){const t={url:`${CF_WORKER_URL}?ip=${encodeURIComponent(e)}`,timeout:TIMEOUT,headers:{Accept:"application/json"}},{data:r}=await httpGet(t),n=JSON.parse(r);if(!n.success)throw new Error(n.error||"æŸ¥è¯¢å¤±è´¥");return n}function formatOutput(e,t){const r=e.data,n=getEmoji(r.fraudScore),o=getEmoji(r.botRatio),a=getScoreText(r.fraudScore),i="ä½å®…"===r.ipAttr?"ğŸ ":"ğŸ¢",s="å¹¿æ’­"===r.ipSource?"ğŸ“¡":"ğŸ¯",l=null!=r.fraudScore?`${r.fraudScore}%`:"N/A",c=null!=r.botRatio?`${r.botRatio}%`:null,u=null!=r.humanRatio?`${r.humanRatio}%`:null,d=getFlag(r.countryCode),p=[r.city,r.region,r.country].filter(Boolean),f=p.length>0?`${d} ${p.join(" â€¢ ")}`:`${d} æœªçŸ¥ä½ç½®`,g=r.asn?`AS${r.asn} ${r.asOrganization||""}`:r.asOrganization||"æœªçŸ¥",m=[];t&&m.push(`ğŸ”— èŠ‚ç‚¹: ${t}`,"");m.push(`ğŸ“ ${e.ip}`,f,"");const h=r.ipAttr||"æœªçŸ¥",b=r.ipSource||"æœªçŸ¥";m.push(`ã€${n}${o} ${h} ${b}ã€‘`,"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"),r.riskLevel?m.push(`âš ï¸ é£é™©: ${l} ${r.riskLevel}`):m.push(`ğŸ¯ çº¯å‡€åº¦: ${l} (${a})`),u&&c?m.push(`ğŸ‘¤ äººç±»: ${u} | ğŸ¤– Bot: ${c}`):c&&m.push(`ğŸ¤– Botæµé‡: ${c}`),m.push(`${i} IPå±æ€§: ${h}`,`${s} IPæ¥æº: ${b}`,"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",`ğŸŒ ISP: ${g}`),r.timezone&&m.push(`â±ï¸ æ—¶åŒº: ${r.timezone}`);const y=[];e.source?.api&&y.push("API"),e.source?.web&&y.push("Web"),y.length>0&&m.push("",`ğŸ“¡ æ•°æ®æº: ${y.join(" + ")}`);const v=getBgColor(r.fraudScore),w=t||e.ip;return{title:`IPPure | ${n}${c?o:""} ${l} ${w}`,content:m.join("\n"),backgroundColor:v,icon:"network","icon-color":v}}(async()=>{try{const e=getSelectedNode();console.log(`[IPPure] å¼€å§‹æ£€æµ‹ï¼ŒèŠ‚ç‚¹: ${e||"å½“å‰è¿æ¥"}`),console.log("[IPPure] æ­¥éª¤1: è·å–å‡ºå£ IP...");const t=await getExitIP(e);console.log(`[IPPure] å‡ºå£ IP: ${t}`),console.log("[IPPure] æ­¥éª¤2: æŸ¥è¯¢ IPPure...");const r=await queryIPPure(t);console.log("[IPPure] æŸ¥è¯¢å®Œæˆ");const n=formatOutput(r,e);$done(n)}catch(e){console.error(`[IPPure] Error: ${e.message}`),$done({title:"IPPure | âŒ æ£€æµ‹å¤±è´¥",content:`é”™è¯¯: ${e.message}\n\nè¯·æ£€æŸ¥:\n1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n2. èŠ‚ç‚¹æ˜¯å¦å¯ç”¨\n3. Worker æ˜¯å¦æ­£å¸¸`,backgroundColor:"#909399",icon:"xmark.circle","icon-color":"#F56C6C"})}})();
